openapi: 3.0.0
info:
  title: SchNet Value API
  description: Backend API for German property valuation based on ImmoWertV standards
  version: 1.0.0

servers:
  - url: http://localhost:5000
    description: Local server

paths:
  /api/health:
    get:
      summary: Health check
      description: Check if backend service is running
      responses:
        200:
          description: Server is running
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: OK
                  message:
                    type: string
                    example: SchNet Value backend is running

  /api/valuation/comparative:
    post:
      summary: Comparative Value Method
      description: Calculates property value using comparable sales and adjustment factors
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - comparables
              properties:
                comparables:
                  type: array
                  items:
                    type: object
                    required:
                      - purchasePrice
                      - afLocation
                      - afSize
                      - afCondition
                      - afEquipment
                      - afTime
                    properties:
                      purchasePrice:
                        type: number
                        example: 350000
                      afLocation:
                        type: number
                        example: 1.05
                      afSize:
                        type: number
                        example: 0.95
                      afCondition:
                        type: number
                        example: 1.1
                      afEquipment:
                        type: number
                        example: 1.0
                      afTime:
                        type: number
                        example: 1.02
      responses:
        200:
          description: Comparative value calculated
          content:
            application/json:
              schema:
                type: object
                properties:
                  method:
                    type: string
                    example: Comparative Value Method
                  value:
                    type: number
                    example: 329479

  /api/valuation/income:
    post:
      summary: Income Capitalization Method (ImmoWertV)
      description: Calculates income-based property value
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                plotArea:
                  type: number
                  example: 500
                landValueRate:
                  type: number
                  example: 400
                livingArea:
                  type: number
                  example: 120
                rentPerSqm:
                  type: number
                  example: 10
                operatingCosts:
                  type: object
                  properties:
                    administration:
                      type: number
                      example: 300
                    maintenancePerSqm:
                      type: number
                      example: 10
                    vacancyRate:
                      type: number
                      example: 0.03
                capitalizationRate:
                  type: number
                  example: 0.035
                remainingUsefulLife:
                  type: number
                  example: 50
                marketAdjustmentFactor:
                  type: number
                  example: 1.0
      responses:
        200:
          description: Income value calculated

  /api/valuation/cost:
    post:
      summary: Cost Approach Method (Sachwertverfahren)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                plotArea:
                  type: number
                  example: 500
                landValueRate:
                  type: number
                  example: 400
                grossFloorArea:
                  type: number
                  example: 180
                standardConstructionCost:
                  type: number
                  example: 870
                constructionIndexCurrent:
                  type: number
                  example: 160
                constructionIndexBase:
                  type: number
                  example: 100
                age:
                  type: number
                  example: 20
                totalUsefulLife:
                  type: number
                  example: 80
                externalFacilitiesRate:
                  type: number
                  example: 0.04
                marketAdjustmentFactor:
                  type: number
                  example: 1.0
      responses:
        "200":
          description: Cost value calculated

  /api/valuation/market-value:
    post:
      summary: Final Market Value (ImmoWertV)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                propertyType:
                  type: string
                  example: Condominium
                comparative:
                  type: object
                income:
                  type: object
                cost:
                  type: object
                spf:
                  type: number
                  example: -10000
      responses:
        "200":
          description: Market value calculated

  /api/auth/register:
    post:
      summary: Register new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                lastName:
                  type: string
                email:
                  type: string
                password:
                  type: string
                company:
                  type: string
                phone:
                  type: string
      responses:
        201:
          description: User registered successfully

  /api/auth/login:
    post:
      summary: Login user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                password:
                  type: string
      responses:
        200:
          description: Login successful

  # Valuation Storage
  /api/valuations/save:
    post:
      summary: Save valuation for user
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        201:
          description: Valuation saved

  /api/valuations:
    get:
      summary: Get user's valuations
      security:
        - bearerAuth: []
      responses:
        200:
          description: List of valuations
